(function(v,r){typeof exports=="object"&&typeof module<"u"?r(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],r):(v=typeof globalThis<"u"?globalThis:v||self,r(v.Vue3Treeselect={},v.Vue))})(this,function(v,r){"use strict";var $=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function T(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var j,Te;function It(){if(Te)return j;Te=1;function e(t,n){var s=n.length,i=t.length;if(i>s)return!1;if(i===s)return t===n;e:for(var o=0,a=0;o<i;o++){for(var u=t.charCodeAt(o);a<s;)if(n.charCodeAt(a++)===u)continue e;return!1}return!0}return j=e,j}var xt=It();const Dt=T(xt);var P,Le;function At(){if(Le)return P;Le=1;function e(){}return P=e,P}var Bt=At();const kt=T(Bt),E=process.env.NODE_ENV==="production"?kt:function(t,n){if(!t()){const s=["[Vue-Treeselect Warning]"].concat(n());console.error(...s)}};function L(e){return function(n,...s){n.type==="mousedown"&&n.button===0&&e.call(this,n,...s)}}function zt(e,t){const n=e.getBoundingClientRect(),s=t.getBoundingClientRect(),i=t.offsetHeight/3;s.bottom+i>n.bottom?e.scrollTop=Math.min(t.offsetTop+t.clientHeight-e.offsetHeight+i,e.scrollHeight):s.top-i<n.top&&(e.scrollTop=Math.max(t.offsetTop-i,0))}var q,Me;function Re(){if(Me)return q;Me=1;function e(t){var n=typeof t;return t!=null&&(n=="object"||n=="function")}return q=e,q}var Q,Ve;function $t(){if(Ve)return Q;Ve=1;var e=typeof $=="object"&&$&&$.Object===Object&&$;return Q=e,Q}var K,Ie;function xe(){if(Ie)return K;Ie=1;var e=$t(),t=typeof self=="object"&&self&&self.Object===Object&&self,n=e||t||Function("return this")();return K=n,K}var U,De;function Ft(){if(De)return U;De=1;var e=xe(),t=function(){return e.Date.now()};return U=t,U}var G,Ae;function Ht(){if(Ae)return G;Ae=1;var e=/\s/;function t(n){for(var s=n.length;s--&&e.test(n.charAt(s)););return s}return G=t,G}var Y,Be;function Wt(){if(Be)return Y;Be=1;var e=Ht(),t=/^\s+/;function n(s){return s&&s.slice(0,e(s)+1).replace(t,"")}return Y=n,Y}var X,ke;function ze(){if(ke)return X;ke=1;var e=xe(),t=e.Symbol;return X=t,X}var J,$e;function jt(){if($e)return J;$e=1;var e=ze(),t=Object.prototype,n=t.hasOwnProperty,s=t.toString,i=e?e.toStringTag:void 0;function o(a){var u=n.call(a,i),d=a[i];try{a[i]=void 0;var l=!0}catch{}var f=s.call(a);return l&&(u?a[i]=d:delete a[i]),f}return J=o,J}var Z,Fe;function Pt(){if(Fe)return Z;Fe=1;var e=Object.prototype,t=e.toString;function n(s){return t.call(s)}return Z=n,Z}var ee,He;function qt(){if(He)return ee;He=1;var e=ze(),t=jt(),n=Pt(),s="[object Null]",i="[object Undefined]",o=e?e.toStringTag:void 0;function a(u){return u==null?u===void 0?i:s:o&&o in Object(u)?t(u):n(u)}return ee=a,ee}var te,We;function Qt(){if(We)return te;We=1;function e(t){return t!=null&&typeof t=="object"}return te=e,te}var ne,je;function Kt(){if(je)return ne;je=1;var e=qt(),t=Qt(),n="[object Symbol]";function s(i){return typeof i=="symbol"||t(i)&&e(i)==n}return ne=s,ne}var se,Pe;function qe(){if(Pe)return se;Pe=1;var e=Wt(),t=Re(),n=Kt(),s=NaN,i=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,a=/^0o[0-7]+$/i,u=parseInt;function d(l){if(typeof l=="number")return l;if(n(l))return s;if(t(l)){var f=typeof l.valueOf=="function"?l.valueOf():l;l=t(f)?f+"":f}if(typeof l!="string")return l===0?l:+l;l=e(l);var h=o.test(l);return h||a.test(l)?u(l.slice(2),h?2:8):i.test(l)?s:+l}return se=d,se}var ie,Qe;function Ut(){if(Qe)return ie;Qe=1;var e=Re(),t=Ft(),n=qe(),s="Expected a function",i=Math.max,o=Math.min;function a(u,d,l){var f,h,O,y,S,N,R=0,x=!1,V=!1,c=!0;if(typeof u!="function")throw new TypeError(s);d=n(d)||0,e(l)&&(x=!!l.leading,V="maxWait"in l,O=V?i(n(l.maxWait)||0,d):O,c="trailing"in l?!!l.trailing:c);function p(m){var w=f,z=h;return f=h=void 0,R=m,y=u.apply(z,w),y}function D(m){return R=m,S=setTimeout(W,d),x?p(m):y}function Pn(m){var w=m-N,z=m-R,Vt=d-w;return V?o(Vt,O-z):Vt}function Mt(m){var w=m-N,z=m-R;return N===void 0||w>=d||w<0||V&&z>=O}function W(){var m=t();if(Mt(m))return Rt(m);S=setTimeout(W,Pn(m))}function Rt(m){return S=void 0,c&&f?p(m):(f=h=void 0,y)}function qn(){S!==void 0&&clearTimeout(S),R=0,f=N=h=S=void 0}function Qn(){return S===void 0?y:Rt(t())}function we(){var m=t(),w=Mt(m);if(f=arguments,h=this,N=m,w){if(S===void 0)return D(N);if(V)return clearTimeout(S),S=setTimeout(W,d),p(N)}return S===void 0&&(S=setTimeout(W,d)),y}return we.cancel=qn,we.flush=Qn,we}return ie=a,ie}var Gt=Ut();const Yt=T(Gt);var Xt=function(e,t){var n=document.createElement("_"),s=n.appendChild(document.createElement("_")),i=n.appendChild(document.createElement("_")),o=s.appendChild(document.createElement("_")),a=void 0,u=void 0;return s.style.cssText=n.style.cssText="height:100%;left:0;opacity:0;overflow:hidden;pointer-events:none;position:absolute;top:0;transition:0s;width:100%;z-index:-1",o.style.cssText=i.style.cssText="display:block;height:100%;transition:0s;width:100%",o.style.width=o.style.height="200%",e.appendChild(n),d(),f;function d(){l();var h=e.offsetWidth,O=e.offsetHeight;(h!==a||O!==u)&&(a=h,u=O,i.style.width=h*2+"px",i.style.height=O*2+"px",n.scrollLeft=n.scrollWidth,n.scrollTop=n.scrollHeight,s.scrollLeft=s.scrollWidth,s.scrollTop=s.scrollHeight,t({width:h,height:O})),s.addEventListener("scroll",d),n.addEventListener("scroll",d)}function l(){s.removeEventListener("scroll",d),n.removeEventListener("scroll",d)}function f(){l(),e.removeChild(n)}};function Ke(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}let re;const F=[],Jt=100;function Zt(){re=setInterval(()=>{F.forEach(Ue)},Jt)}function en(){clearInterval(re),re=null}function Ue(e){const{$el:t,listener:n,lastWidth:s,lastHeight:i}=e,o=t.offsetWidth,a=t.offsetHeight;(s!==o||i!==a)&&(e.lastWidth=o,e.lastHeight=a,n({width:o,height:a}))}function tn(e,t){const n={$el:e,listener:t,lastWidth:null,lastHeight:null},s=()=>{Ke(F,n),F.length||en()};return F.push(n),Ue(n),Zt(),s}function Ge(e,t){const n=document.documentMode===9;let s=!0;const a=(n?tn:Xt)(e,(...u)=>s||t(...u));return s=!1,a}function nn(e){const t=[];let n=e.parentNode;for(;n&&n.nodeName!=="BODY"&&n.nodeType===document.ELEMENT_NODE;)sn(n)&&t.push(n),n=n.parentNode;return t.push(window),t}function sn(e){const{overflow:t,overflowX:n,overflowY:s}=getComputedStyle(e);return/(auto|scroll|overlay)/.test(t+s+n)}function Ye(e,t){const n=nn(e);return window.addEventListener("resize",t,{passive:!0}),n.forEach(s=>{s.addEventListener("scroll",t,{passive:!0})}),function(){window.removeEventListener("resize",t,{passive:!0}),n.forEach(i=>{i.removeEventListener("scroll",t,{passive:!0})})}}function Xe(e){return e!==e}function Je(e){return!!e&&(typeof e=="object"||typeof e=="function")&&typeof e.then=="function"}var oe,Ze;function rn(){if(Ze)return oe;Ze=1;var e=qe(),t=1/0,n=17976931348623157e292;function s(i){if(!i)return i===0?i:0;if(i=e(i),i===t||i===-t){var o=i<0?-1:1;return o*n}return i===i?i:0}return oe=s,oe}var ae,et;function on(){if(et)return ae;et=1;var e=rn();function t(n){var s=e(n),i=s%1;return s===s?i?s-i:s:0}return ae=t,ae}var le,tt;function an(){if(tt)return le;tt=1;var e=on(),t="Expected a function";function n(s,i){var o;if(typeof i!="function")throw new TypeError(t);return s=e(s),function(){return--s>0&&(o=i.apply(this,arguments)),s<=1&&(i=void 0),o}}return le=n,le}var ce,nt;function ln(){if(nt)return ce;nt=1;var e=an();function t(n){return e(2,n)}return ce=t,ce}var cn=ln();const un=T(cn);var ue,st;function dn(){if(st)return ue;st=1;function e(t){return t}return ue=e,ue}var hn=dn();const fn=T(hn);var de,it;function pn(){if(it)return de;it=1;function e(t){return function(){return t}}return de=e,de}var mn=pn();const rt=T(mn),b=()=>Object.create(null);function ot(e){return e==null||typeof e!="object"?!1:Object.getPrototypeOf(e)===Object.prototype}function gn(e,t,n){ot(n)?(e[t]||(e[t]={}),he(e[t],n)):e[t]=n}function he(e,t){if(ot(t)){const n=Object.keys(t);for(let s=0,i=n.length;s<i;s++)gn(e,n[s],t[n[s]])}return e}var fe,at;function Sn(){if(at)return fe;at=1;function e(t){var n=t==null?0:t.length;return n?t[n-1]:void 0}return fe=e,fe}var vn=Sn();const lt=T(vn);function C(e,t){return e.indexOf(t)!==-1}function ct(e,t,n){for(let s=0,i=e.length;s<i;s++)if(t.call(n,e[s],s,e))return e[s]}function pe(e,t){if(e.length!==t.length)return!0;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!0;return!1}const M=null,me=0,ut=1,dt=2,I="ALL_CHILDREN",A="ALL_DESCENDANTS",B="LEAF_CHILDREN",k="LEAF_DESCENDANTS",ht="LOAD_ROOT_OPTIONS",ft="LOAD_CHILDREN_OPTIONS",pt="ASYNC_SEARCH",ge="ALL",H="BRANCH_PRIORITY",Se="LEAF_PRIORITY",ve="ALL_WITH_INDETERMINATE",mt="ORDER_SELECTED",gt="LEVEL",St="INDEX",g={BACKSPACE:8,ENTER:13,ESCAPE:27,END:35,HOME:36,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40,DELETE:46},On=process.env.NODE_ENV==="testing"?10:200,vt=5,Ot=40;function bt(e,t){let n=0;do{if(e.level<n)return-1;if(t.level<n)return 1;if(e.index[n]!==t.index[n])return e.index[n]-t.index[n];n++}while(!0)}function bn(e,t){return e.level===t.level?bt(e,t):e.level-t.level}function Oe(){return{isLoaded:!1,isLoading:!1,loadingError:""}}function yn(e){return typeof e=="string"?e:typeof e=="number"&&!Xe(e)?e+"":""}function yt(e,t,n){return e?Dt(t,n):C(n,t)}function be(e){return e.message||String(e)}let Nn=0;const Nt={provide(){return{instance:this}},props:{allowClearingDisabled:{type:Boolean,default:!1},allowSelectingDisabledDescendants:{type:Boolean,default:!1},alwaysOpen:{type:Boolean,default:!1},appendToBody:{type:Boolean,default:!1},async:{type:Boolean,default:!1},autoFocus:{type:Boolean,default:!1},autoLoadRootOptions:{type:Boolean,default:!0},autoDeselectAncestors:{type:Boolean,default:!1},autoDeselectDescendants:{type:Boolean,default:!1},autoSelectAncestors:{type:Boolean,default:!1},autoSelectDescendants:{type:Boolean,default:!1},backspaceRemoves:{type:Boolean,default:!0},beforeClearAll:{type:Function,default:rt(!0)},branchNodesFirst:{type:Boolean,default:!1},cacheOptions:{type:Boolean,default:!0},clearable:{type:Boolean,default:!0},clearAllText:{type:String,default:"Clear all"},clearOnSelect:{type:Boolean,default:!1},clearValueText:{type:String,default:"Clear value"},closeOnSelect:{type:Boolean,default:!0},defaultExpandLevel:{type:Number,default:0},defaultOptions:{default:!1},deleteRemoves:{type:Boolean,default:!0},delimiter:{type:String,default:","},flattenSearchResults:{type:Boolean,default:!1},disableBranchNodes:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},disableFuzzyMatching:{type:Boolean,default:!1},flat:{type:Boolean,default:!1},instanceId:{default:()=>`${Nn++}$$`,type:[String,Number]},joinValues:{type:Boolean,default:!1},limit:{type:Number,default:1/0},limitText:{type:Function,default:function(t){return`and ${t} more`}},loadingText:{type:String,default:"Loading..."},loadOptions:{type:Function},matchKeys:{type:Array,default:rt(["label"])},maxHeight:{type:Number,default:300},multiple:{type:Boolean,default:!1},name:{type:String},noChildrenText:{type:String,default:"No sub-options."},noOptionsText:{type:String,default:"No options available."},noResultsText:{type:String,default:"No results found..."},normalizer:{type:Function,default:fn},openDirection:{type:String,default:"auto",validator(e){return C(["auto","top","bottom","above","below"],e)}},openOnClick:{type:Boolean,default:!0},openOnFocus:{type:Boolean,default:!1},options:{type:Array},placeholder:{type:String,default:"Select..."},required:{type:Boolean,default:!1},retryText:{type:String,default:"Retry?"},retryTitle:{type:String,default:"Click to retry"},searchable:{type:Boolean,default:!0},searchNested:{type:Boolean,default:!1},searchPromptText:{type:String,default:"Type to search..."},showCount:{type:Boolean,default:!1},showCountOf:{type:String,default:I,validator(e){return C([I,A,B,k],e)}},showCountOnSearch:null,sortValueBy:{type:String,default:mt,validator(e){return C([mt,gt,St],e)}},tabIndex:{type:Number,default:0},modelValue:null,valueConsistsOf:{type:String,default:H,validator(e){return C([ge,H,Se,ve],e)}},valueFormat:{type:String,default:"id"},zIndex:{type:[Number,String],default:999}},data(){return{key:0,trigger:{isFocused:!1,searchQuery:""},menu:{isOpen:!1,current:null,lastScrollPosition:0,placement:"bottom"},forest:{normalizedOptions:[],nodeMap:b(),checkedStateMap:b(),selectedNodeIds:this.extractCheckedNodeIdsFromValue(),selectedNodeMap:b()},rootOptionsStates:Oe(),localSearch:{active:!1,noResults:!0,countMap:b()},remoteSearch:b()}},computed:{selectedNodes(){return this.forest.selectedNodeIds.map(this.getNode)},internalValue(){let e;if(this.single||this.flat||this.disableBranchNodes||this.valueConsistsOf===ge)e=this.forest.selectedNodeIds.slice();else if(this.valueConsistsOf===H)e=this.forest.selectedNodeIds.filter(t=>{const n=this.getNode(t);return n.isRootNode?!0:!this.isSelected(n.parentNode)});else if(this.valueConsistsOf===Se)e=this.forest.selectedNodeIds.filter(t=>{const n=this.getNode(t);return n.isLeaf?!0:n.children.length===0});else if(this.valueConsistsOf===ve){const t=[];e=this.forest.selectedNodeIds.slice(),this.selectedNodes.forEach(n=>{n.ancestors.forEach(s=>{C(t,s.id)||C(e,s.id)||t.push(s.id)})}),e.push(...t)}return this.sortValueBy===gt?e.sort((t,n)=>bn(this.getNode(t),this.getNode(n))):this.sortValueBy===St&&e.sort((t,n)=>bt(this.getNode(t),this.getNode(n))),e},hasValue(){return this.internalValue.length>0},single(){return!this.multiple},visibleOptionIds(){const e=[];return this.traverseAllNodesByIndex(t=>{if((!this.localSearch.active||this.shouldOptionBeIncludedInSearchResult(t))&&e.push(t.id),t.isBranch&&!this.shouldExpand(t))return!1}),e},hasVisibleOptions(){return this.visibleOptionIds.length!==0},showCountOnSearchComputed(){return typeof this.showCountOnSearch=="boolean"?this.showCountOnSearch:this.showCount},hasBranchNodes(){return this.forest.normalizedOptions.some(e=>e.isBranch)},shouldFlattenOptions(){return this.localSearch.active&&this.flattenSearchResults}},watch:{alwaysOpen(e){e?this.openMenu():this.closeMenu()},branchNodesFirst(){this.initialize()},disabled(e){e&&this.menu.isOpen?this.closeMenu():!e&&!this.menu.isOpen&&this.alwaysOpen&&this.openMenu()},flat(){this.initialize()},internalValue(e,t){pe(e,t)&&this.$emit("update:modelValue",this.getValue(),this.getInstanceId())},matchKeys(){this.initialize()},multiple(e){e&&this.buildForestState()},options:{handler(){this.async||(this.initialize(),this.rootOptionsStates.isLoaded=Array.isArray(this.options))},deep:!0,immediate:!0},"trigger.searchQuery"(){this.async?this.handleRemoteSearch():this.handleLocalSearch(),this.$emit("search-change",this.trigger.searchQuery,this.getInstanceId())},modelValue(){const e=this.extractCheckedNodeIdsFromValue();pe(e,this.internalValue)&&this.fixSelectedNodeIds(e)}},methods:{verifyProps(){E(()=>this.async?this.searchable:!0,()=>'For async search mode, the value of "searchable" prop must be true.'),this.options==null&&!this.loadOptions&&E(()=>!1,()=>'Are you meant to dynamically load options? You need to use "loadOptions" prop.'),this.flat&&E(()=>this.multiple,()=>'You are using flat mode. But you forgot to add "multiple=true"?'),this.flat||["autoSelectAncestors","autoSelectDescendants","autoDeselectAncestors","autoDeselectDescendants"].forEach(t=>{E(()=>!this[t],()=>`"${t}" only applies to flat mode.`)})},resetFlags(){this._blurOnSelect=!1},initialize(){const e=this.async?this.getRemoteSearchEntry().options:this.options;if(Array.isArray(e)){const t=this.forest.nodeMap;this.forest.nodeMap=b(),this.keepDataOfSelectedNodes(t),this.forest.normalizedOptions=this.normalize(M,e,t),this.fixSelectedNodeIds(this.internalValue)}else this.forest.normalizedOptions=[]},getInstanceId(){return this.instanceId==null?this.id:this.instanceId},getValue(){if(this.valueFormat==="id")return this.multiple?this.internalValue.slice():this.internalValue[0];const e=this.internalValue.map(t=>this.getNode(t).raw);return this.multiple?e:e[0]},getNode(e){return E(()=>e!=null,()=>`Invalid node id: ${e}`),e==null?null:e in this.forest.nodeMap?this.forest.nodeMap[e]:this.createFallbackNode(e)},createFallbackNode(e){const t=this.extractNodeFromValue(e),n=this.enhancedNormalizer(t).label||`${e} (unknown)`,s={id:e,label:n,ancestors:[],parentNode:M,isFallbackNode:!0,isRootNode:!0,isLeaf:!0,isBranch:!1,isDisabled:!1,isNew:!1,index:[-1],level:0,raw:t};return this.forest.nodeMap[e]=s},extractCheckedNodeIdsFromValue(){return this.modelValue==null?[]:this.valueFormat==="id"?this.multiple?this.modelValue.slice():[this.modelValue]:(this.multiple?this.modelValue:[this.modelValue]).map(e=>this.enhancedNormalizer(e)).map(e=>e.id)},extractNodeFromValue(e){const t={id:e};if(this.valueFormat==="id")return t;const n=this.multiple?Array.isArray(this.modelValue)?this.modelValue:[]:this.modelValue?[this.modelValue]:[];return ct(n,i=>i&&this.enhancedNormalizer(i).id===e)||t},fixSelectedNodeIds(e){let t=[];if(this.single||this.flat||this.disableBranchNodes||this.valueConsistsOf===ge)t=e;else if(this.valueConsistsOf===H)e.forEach(s=>{t.push(s);const i=this.getNode(s);i.isBranch&&this.traverseDescendantsBFS(i,o=>{t.push(o.id)})});else if(this.valueConsistsOf===Se){const s=b(),i=e.slice();for(;i.length;){const o=i.shift(),a=this.getNode(o);t.push(o),!a.isRootNode&&(a.parentNode.id in s||(s[a.parentNode.id]=a.parentNode.children.length),--s[a.parentNode.id]===0&&i.push(a.parentNode.id))}}else if(this.valueConsistsOf===ve){const s=b(),i=e.filter(o=>{const a=this.getNode(o);return a.isLeaf||a.children.length===0});for(;i.length;){const o=i.shift(),a=this.getNode(o);t.push(o),!a.isRootNode&&(a.parentNode.id in s||(s[a.parentNode.id]=a.parentNode.children.length),--s[a.parentNode.id]===0&&i.push(a.parentNode.id))}}pe(this.forest.selectedNodeIds,t)&&(this.forest.selectedNodeIds=t),this.buildForestState()},keepDataOfSelectedNodes(e){this.forest.selectedNodeIds.forEach(t=>{if(!e[t])return;const n={...e[t],isFallbackNode:!0};this.forest.nodeMap[t]=n})},isSelected(e){return e&&this.forest.selectedNodeMap[e.id]===!0},traverseDescendantsBFS(e,t){if(!e.isBranch)return;const n=e.children.slice();for(;n.length;){const s=n[0];s.isBranch&&n.push(...s.children),t(s),n.shift()}},traverseDescendantsDFS(e,t){e.isBranch&&e.children.forEach(n=>{this.traverseDescendantsDFS(n,t),t(n)})},traverseAllNodesDFS(e){this.forest.normalizedOptions.forEach(t=>{this.traverseDescendantsDFS(t,e),e(t)})},traverseAllNodesByIndex(e){const t=n=>{n.children.forEach(s=>{e(s)!==!1&&s.isBranch&&t(s)})};t({children:this.forest.normalizedOptions})},toggleClickOutsideEvent(e){e?document.addEventListener("mousedown",this.handleClickOutside,!1):document.removeEventListener("mousedown",this.handleClickOutside,!1)},getValueContainer(){return this.$refs.control.$refs["value-container"]},getInput(){return this.getValueContainer().$refs.input},focusInput(){this.getInput().focus()},blurInput(){this.getInput().blur()},handleMouseDown:L(function(t){if(t.preventDefault(),t.stopPropagation(),this.disabled)return;this.getValueContainer().$el.contains(t.target)&&!this.menu.isOpen&&(this.openOnClick||this.trigger.isFocused)&&this.openMenu(),this._blurOnSelect?this.blurInput():this.focusInput(),this.resetFlags()}),handleClickOutside(e){this.$refs.wrapper&&!this.$refs.wrapper.contains(e.target)&&(this.blurInput(),this.closeMenu())},handleLocalSearch(){const{searchQuery:e}=this.trigger,t=()=>this.resetHighlightedOptionWhenNecessary(!0);if(!e)return this.localSearch.active=!1,t();this.localSearch.active=!0,this.localSearch.noResults=!0,this.traverseAllNodesDFS(i=>{i.isBranch&&(i.isExpandedOnSearch=!1,i.showAllChildrenOnSearch=!1,i.isMatched=!1,i.hasMatchedDescendants=!1,this.localSearch.countMap[i.id]={[I]:0,[A]:0,[B]:0,[k]:0})});const n=e.trim().toLocaleLowerCase(),s=n.replace(/\s+/g," ").split(" ");this.traverseAllNodesDFS(i=>{this.searchNested&&s.length>1?i.isMatched=s.every(o=>yt(!1,o,i.nestedSearchLabel)):i.isMatched=this.matchKeys.some(o=>yt(!this.disableFuzzyMatching,n,i.lowerCased[o])),i.isMatched&&(this.localSearch.noResults=!1,i.ancestors.forEach(o=>this.localSearch.countMap[o.id][A]++),i.isLeaf&&i.ancestors.forEach(o=>this.localSearch.countMap[o.id][k]++),i.parentNode!==M&&(this.localSearch.countMap[i.parentNode.id][I]+=1,i.isLeaf&&(this.localSearch.countMap[i.parentNode.id][B]+=1))),(i.isMatched||i.isBranch&&i.isExpandedOnSearch)&&i.parentNode!==M&&(i.parentNode.isExpandedOnSearch=!0,i.parentNode.hasMatchedDescendants=!0)}),t()},handleRemoteSearch(){const{searchQuery:e}=this.trigger,t=this,n=this.getRemoteSearchEntry(),s=()=>{this.initialize(),this.resetHighlightedOptionWhenNecessary(!0)};if((e===""||this.cacheOptions)&&n.isLoaded)return s();this.callLoadOptionsProp({action:pt,args:{searchQuery:e},isPending(){return n.isLoading},start:()=>{n.isLoading=!0,n.isLoaded=!1,n.loadingError=""},succeed:i=>{n.isLoaded=!0,n.options=i,this.trigger.searchQuery===e&&s()},fail:i=>{n.loadingError=be(i)},end:()=>{t.key+=1,n.isLoading=!1}})},getRemoteSearchEntry(){const{searchQuery:e}=this.trigger,t=this.remoteSearch[e]||{...Oe(),options:[]};if(this.$watch(()=>t.options,()=>{this.trigger.searchQuery===e&&this.initialize()},{deep:!0}),e===""){if(Array.isArray(this.defaultOptions))return t.options=this.defaultOptions,t.isLoaded=!0,t;if(this.defaultOptions!==!0)return t.isLoaded=!0,t}return this.remoteSearch[e]||(this.remoteSearch[e]=t),t},shouldExpand(e){return this.localSearch.active?e.isExpandedOnSearch:e.isExpanded},shouldOptionBeIncludedInSearchResult(e){return!!(e.isMatched||e.isBranch&&e.hasMatchedDescendants&&!this.flattenSearchResults||!e.isRootNode&&e.parentNode.showAllChildrenOnSearch)},shouldShowOptionInMenu(e){return!(this.localSearch.active&&!this.shouldOptionBeIncludedInSearchResult(e))},getControl(){return this.$refs.control.$el},getMenu(){var n;const e=this.appendToBody&&this.$refs.portal?this.$refs.portal.portalTarget:this,t=(n=e==null?void 0:e.$refs)==null?void 0:n.menu.$refs.menu;return t&&t.nodeName!=="#comment"?t:null},setCurrentHighlightedOption(e,t=!0){const n=this.menu.current;if(n!=null&&n in this.forest.nodeMap&&(this.forest.nodeMap[n].isHighlighted=!1),!e){this.menu.current=null;return}if(this.menu.current=e.id,e.isHighlighted=!0,this.menu.isOpen&&t){const s=()=>{const i=this.getMenu(),o=i.querySelector(`.vue-treeselect__option[data-id="${e.id}"]`);o&&zt(i,o)};this.getMenu()?s():this.$nextTick(s)}},resetHighlightedOptionWhenNecessary(e=!1){const{current:t}=this.menu;(e||t==null||!(t in this.forest.nodeMap)||!this.shouldShowOptionInMenu(this.getNode(t)))&&this.highlightFirstOption()},highlightFirstOption(){if(!this.hasVisibleOptions)return;const e=this.visibleOptionIds[0];this.setCurrentHighlightedOption(this.getNode(e))},highlightPrevOption(){if(!this.hasVisibleOptions)return;const e=this.visibleOptionIds.indexOf(this.menu.current)-1;if(e===-1)return this.highlightLastOption();this.setCurrentHighlightedOption(this.getNode(this.visibleOptionIds[e]))},highlightNextOption(){if(!this.hasVisibleOptions)return;const e=this.visibleOptionIds.indexOf(this.menu.current)+1;if(e===this.visibleOptionIds.length)return this.highlightFirstOption();this.setCurrentHighlightedOption(this.getNode(this.visibleOptionIds[e]))},highlightLastOption(){if(!this.hasVisibleOptions)return;const e=lt(this.visibleOptionIds);this.setCurrentHighlightedOption(this.getNode(e))},resetSearchQuery(){this.trigger.searchQuery=""},closeMenu(){!this.menu.isOpen||!this.disabled&&this.alwaysOpen||(this.saveMenuScrollPosition(),this.menu.isOpen=!1,this.toggleClickOutsideEvent(!1),this.resetSearchQuery(),this.$emit("close",this.getValue(),this.getInstanceId()))},openMenu(){this.disabled||this.menu.isOpen||(this.menu.isOpen=!0,this.$nextTick(this.resetHighlightedOptionWhenNecessary),this.$nextTick(this.restoreMenuScrollPosition),!this.options&&!this.async&&this.loadRootOptions(),this.toggleClickOutsideEvent(!0),this.$emit("open",this.getInstanceId()))},toggleMenu(){this.menu.isOpen?this.closeMenu():this.openMenu()},toggleExpanded(e){let t;this.localSearch.active?(t=e.isExpandedOnSearch=!e.isExpandedOnSearch,t&&(e.showAllChildrenOnSearch=!0)):t=e.isExpanded=!e.isExpanded,t&&!e.childrenStates.isLoaded&&this.loadChildrenOptions(e)},buildForestState(){const e=b();this.forest.selectedNodeIds.forEach(n=>{e[n]=!0}),this.forest.selectedNodeMap=e;const t=b();this.multiple&&(this.traverseAllNodesByIndex(n=>{t[n.id]=me}),this.selectedNodes.forEach(n=>{t[n.id]=dt,!this.flat&&!this.disableBranchNodes&&n.ancestors.forEach(s=>{this.isSelected(s)||(t[s.id]=ut)})})),this.forest.checkedStateMap=t},enhancedNormalizer(e){return{...e,...this.normalizer(e,this.getInstanceId())}},normalize(e,t,n){let s=t.map(i=>[this.enhancedNormalizer(i),i]).map(([i,o],a)=>{this.checkDuplication(i),this.verifyNodeShape(i);const{id:u,label:d,children:l,isDefaultExpanded:f}=i,h=e===M,O=h?0:e.level+1,y=Array.isArray(l)||l===null,S=!y,N=!!i.isDisabled||!this.flat&&!h&&e.isDisabled,R=!!i.isNew,x=this.matchKeys.reduce((p,D)=>({...p,[D]:yn(i[D]).toLocaleLowerCase()}),{}),V=h?x.label:e.nestedSearchLabel+" "+x.label;this.forest.nodeMap[u]=b();const c=this.forest.nodeMap[u];if(c.id=u,c.label=d,c.level=O,c.ancestors=h?[]:[e].concat(e.ancestors),c.index=(h?[]:e.index).concat(a),c.parentNode=e,c.lowerCased=x,c.nestedSearchLabel=V,c.isDisabled=N,c.isNew=R,c.isMatched=!1,c.isHighlighted=!1,c.isBranch=y,c.isLeaf=S,c.isRootNode=h,c.raw=o,y){const p=Array.isArray(l);c.childrenStates={...Oe(),isLoaded:p},c.isExpanded=typeof f=="boolean"?f:O<this.defaultExpandLevel,c.hasMatchedDescendants=!1,c.hasDisabledDescendants=!1,c.isExpandedOnSearch=!1,c.showAllChildrenOnSearch=!1,c.count={[I]:0,[A]:0,[B]:0,[k]:0},c.children=p?this.normalize(c,l,n):[],f===!0&&c.ancestors.forEach(D=>{D.isExpanded=!0}),!p&&typeof this.loadOptions!="function"?E(()=>!1,()=>'Unloaded branch node detected. "loadOptions" prop is required to load its children.'):!p&&c.isExpanded&&this.loadChildrenOptions(c)}if(c.ancestors.forEach(p=>p.count[A]++),S&&c.ancestors.forEach(p=>p.count[k]++),h||(e.count[I]+=1,S&&(e.count[B]+=1),N&&(e.hasDisabledDescendants=!0)),n&&n[u]){const p=n[u];c.isMatched=p.isMatched,c.showAllChildrenOnSearch=p.showAllChildrenOnSearch,c.isHighlighted=p.isHighlighted,p.isBranch&&c.isBranch&&(c.isExpanded=p.isExpanded,c.isExpandedOnSearch=p.isExpandedOnSearch,p.childrenStates.isLoaded&&!c.childrenStates.isLoaded?c.isExpanded=!1:c.childrenStates={...p.childrenStates})}return c});if(this.branchNodesFirst){const i=s.filter(a=>a.isBranch),o=s.filter(a=>a.isLeaf);s=i.concat(o)}return s},loadRootOptions(){this.callLoadOptionsProp({action:ht,isPending:()=>this.rootOptionsStates.isLoading,start:()=>{this.rootOptionsStates.isLoading=!0,this.rootOptionsStates.loadingError=""},succeed:()=>{this.rootOptionsStates.isLoaded=!0,this.$nextTick(()=>{this.resetHighlightedOptionWhenNecessary(!0)})},fail:e=>{this.rootOptionsStates.loadingError=be(e)},end:()=>{this.rootOptionsStates.isLoading=!1}})},loadChildrenOptions(e){const{id:t,raw:n}=e;this.callLoadOptionsProp({action:ft,args:{parentNode:n},isPending:()=>this.getNode(t).childrenStates.isLoading,start:()=>{this.getNode(t).childrenStates.isLoading=!0,this.getNode(t).childrenStates.loadingError=""},succeed:()=>{this.getNode(t).childrenStates.isLoaded=!0},fail:s=>{this.getNode(t).childrenStates.loadingError=be(s)},end:()=>{this.getNode(t).childrenStates.isLoading=!1}})},callLoadOptionsProp({action:e,args:t,isPending:n,start:s,succeed:i,fail:o,end:a}){if(!this.loadOptions||n())return;s();const u=un((l,f)=>{l?o(l):i(f),a()}),d=this.loadOptions({id:this.getInstanceId(),instanceId:this.getInstanceId(),action:e,...t,callback:u});Je(d)&&d.then(()=>{u()},l=>{u(l)}).catch(l=>{console.error(l)})},checkDuplication(e){E(()=>!(e.id in this.forest.nodeMap&&!this.forest.nodeMap[e.id].isFallbackNode),()=>`Detected duplicate presence of node id ${JSON.stringify(e.id)}. Their labels are "${this.forest.nodeMap[e.id].label}" and "${e.label}" respectively.`)},verifyNodeShape(e){E(()=>!(e.children===void 0&&e.isBranch===!0),()=>"Are you meant to declare an unloaded branch node? `isBranch: true` is no longer supported, please use `children: null` instead.")},select(e){if(this.disabled||e.isDisabled)return;this.single&&this.clear();const t=this.multiple&&!this.flat?this.forest.checkedStateMap[e.id]===me:!this.isSelected(e);t?this._selectNode(e):this._deselectNode(e),this.buildForestState(),t?this.$emit("select",e.raw,this.getInstanceId()):this.$emit("deselect",e.raw,this.getInstanceId()),this.localSearch.active&&t&&(this.single||this.clearOnSelect)&&this.resetSearchQuery(),this.single&&this.closeOnSelect&&(this.closeMenu(),this.searchable&&(this._blurOnSelect=!0))},clear(){this.hasValue&&(this.single||this.allowClearingDisabled?this.forest.selectedNodeIds=[]:this.forest.selectedNodeIds=this.forest.selectedNodeIds.filter(e=>this.getNode(e).isDisabled),this.buildForestState())},_selectNode(e){if(this.single||this.disableBranchNodes)return this.addValue(e);if(this.flat){this.addValue(e),this.autoSelectAncestors?e.ancestors.forEach(n=>{!this.isSelected(n)&&!n.isDisabled&&this.addValue(n)}):this.autoSelectDescendants&&this.traverseDescendantsBFS(e,n=>{!this.isSelected(n)&&!n.isDisabled&&this.addValue(n)});return}const t=e.isLeaf||!e.hasDisabledDescendants||this.allowSelectingDisabledDescendants;if(t&&this.addValue(e),e.isBranch&&this.traverseDescendantsBFS(e,n=>{(!n.isDisabled||this.allowSelectingDisabledDescendants)&&this.addValue(n)}),t){let n=e;for(;(n=n.parentNode)!==M&&n.children.every(this.isSelected);)this.addValue(n)}},_deselectNode(e){if(this.disableBranchNodes)return this.removeValue(e);if(this.flat){this.removeValue(e),this.autoDeselectAncestors?e.ancestors.forEach(n=>{this.isSelected(n)&&!n.isDisabled&&this.removeValue(n)}):this.autoDeselectDescendants&&this.traverseDescendantsBFS(e,n=>{this.isSelected(n)&&!n.isDisabled&&this.removeValue(n)});return}let t=!1;if(e.isBranch&&this.traverseDescendantsDFS(e,n=>{(!n.isDisabled||this.allowSelectingDisabledDescendants)&&(this.removeValue(n),t=!0)}),e.isLeaf||t||e.children.length===0){this.removeValue(e);let n=e;for(;(n=n.parentNode)!==M&&this.isSelected(n);)this.removeValue(n)}},addValue(e){this.forest.selectedNodeIds.push(e.id),this.forest.selectedNodeMap[e.id]=!0},removeValue(e){Ke(this.forest.selectedNodeIds,e.id),delete this.forest.selectedNodeMap[e.id]},removeLastValue(){if(!this.hasValue)return;if(this.single)return this.clear();const e=lt(this.internalValue),t=this.getNode(e);this.select(t)},saveMenuScrollPosition(){const e=this.getMenu();e&&(this.menu.lastScrollPosition=e.scrollTop)},restoreMenuScrollPosition(){const e=this.getMenu();e&&(e.scrollTop=this.menu.lastScrollPosition)}},created(){this.verifyProps(),this.resetFlags()},mounted(){this.autoFocus&&this.focusInput(),!this.options&&!this.async&&this.autoLoadRootOptions&&this.loadRootOptions(),this.alwaysOpen&&this.openMenu(),this.async&&this.defaultOptions&&this.handleRemoteSearch()},unmounted(){this.toggleClickOutsideEvent(!1)}};function _n(e){return typeof e=="string"?e:e!=null&&!Xe(e)?JSON.stringify(e):""}const En=r.defineComponent({name:"vue-treeselect--hidden-fields",inject:["instance"],functional:!0,render(e){const t=e.instance;if(!t||!t.name||t.disabled||!t.hasValue)return null;let n=t.internalValue.map(_n);return t.multiple&&t.joinValues&&(n=[n.join(t.delimiter)]),n.map((s,i)=>r.createVNode("input",{type:"hidden",name:t.name,value:s,key:"hidden-field-"+i},null))}}),Cn=[g.ENTER,g.END,g.HOME,g.ARROW_LEFT,g.ARROW_UP,g.ARROW_RIGHT,g.ARROW_DOWN],_t={name:"vue-treeselect--input",inject:["instance"],data:()=>({inputWidth:vt,value:""}),computed:{needAutoSize(){const{instance:e}=this;return e.searchable&&!e.disabled&&e.multiple},inputStyle(){return{width:this.needAutoSize?`${this.inputWidth}px`:null}}},watch:{"instance.trigger.searchQuery"(e){this.value=e},value(){this.needAutoSize&&this.$nextTick(this.updateInputWidth)}},created(){this.debouncedCallback=Yt(this.updateSearchQuery,On,{leading:!0,trailing:!0})},methods:{clear(){this.onInput({target:{value:""}})},focus(){const{instance:e}=this;e.disabled||this.$refs.input&&this.$refs.input.focus()},blur(){this.$refs.input&&this.$refs.input.blur()},onFocus(){const{instance:e}=this;e.trigger.isFocused=!0,e.openOnFocus&&e.openMenu()},onBlur(){const{instance:e}=this,t=e.getMenu();if(t&&document.activeElement===t)return this.focus();e.trigger.isFocused=!1,e.closeMenu()},onInput(e){const{value:t}=e.target;this.value=t,t?this.debouncedCallback():(this.debouncedCallback.cancel(),this.updateSearchQuery())},onKeyDown(e){const{instance:t}=this,n="which"in e?e.which:e.keyCode;if(!(e.ctrlKey||e.shiftKey||e.altKey||e.metaKey)){if(!t.menu.isOpen&&C(Cn,n))return e.preventDefault(),t.openMenu();switch(n){case g.BACKSPACE:{t.backspaceRemoves&&!this.value.length&&t.removeLastValue();break}case g.ENTER:{if(e.preventDefault(),t.menu.current===null)return;const s=t.getNode(t.menu.current);if(s.isBranch&&t.disableBranchNodes)return;t.select(s);break}case g.ESCAPE:{this.value.length?this.clear():t.menu.isOpen&&t.closeMenu();break}case g.END:{e.preventDefault(),t.highlightLastOption();break}case g.HOME:{e.preventDefault(),t.highlightFirstOption();break}case g.ARROW_LEFT:{const s=t.getNode(t.menu.current);s.isBranch&&t.shouldExpand(s)?(e.preventDefault(),t.toggleExpanded(s)):!s.isRootNode&&(s.isLeaf||s.isBranch&&!t.shouldExpand(s))&&(e.preventDefault(),t.setCurrentHighlightedOption(s.parentNode));break}case g.ARROW_UP:{e.preventDefault(),t.highlightPrevOption();break}case g.ARROW_RIGHT:{const s=t.getNode(t.menu.current);s.isBranch&&!t.shouldExpand(s)&&(e.preventDefault(),t.toggleExpanded(s));break}case g.ARROW_DOWN:{e.preventDefault(),t.highlightNextOption();break}case g.DELETE:{t.deleteRemoves&&!this.value.length&&t.removeLastValue();break}default:t.openMenu()}}},onMouseDown(e){this.value.length&&e.stopPropagation()},renderInputContainer(){const{instance:e}=this,t={},n=[];return e.searchable&&!e.disabled&&(n.push(this.renderInput()),this.needAutoSize&&n.push(this.renderSizer())),e.searchable||he(t,{on:{focus:this.onFocus,blur:this.onBlur,keydown:this.onKeyDown},ref:"input"}),!e.searchable&&!e.disabled&&he(t,{attrs:{tabIndex:e.tabIndex}}),r.createVNode("div",r.mergeProps({class:"vue-treeselect__input-container"},t),[n])},renderInput(){const{instance:e}=this;return r.createVNode("input",{ref:"input",class:"vue-treeselect__input",type:"text",autocomplete:"off",tabIndex:e.tabIndex,required:e.required&&!e.hasValue,value:this.value,style:this.inputStyle,onFocus:this.onFocus,onInput:this.onInput,onBlur:this.onBlur,onKeydown:this.onKeyDown,onMousedown:this.onMouseDown},null)},renderSizer(){return r.createVNode("div",{ref:"sizer",class:"vue-treeselect__sizer"},[this.value])},updateInputWidth(){this.inputWidth=Math.max(vt,this.$refs.sizer.scrollWidth+15)},updateSearchQuery(){const{instance:e}=this;e.trigger.searchQuery=this.value}},render(){return this.renderInputContainer()}},Et={name:"vue-treeselect--placeholder",inject:["instance"],render(){const{instance:e}=this,t={"vue-treeselect__placeholder":!0,"vue-treeselect-helper-zoom-effect-off":!0,"vue-treeselect-helper-hide":e.hasValue||e.trigger.searchQuery};return r.createVNode("div",{class:t},[e.placeholder])}},wn={name:"vue-treeselect--single-value",inject:["instance"],methods:{renderSingleValueLabel(){const{instance:e}=this,t=e.selectedNodes[0],n=e.$slots["value-label"];return n?n({node:t}):t.label}},render(){const{instance:e,$parent:{renderValueContainer:t}}=this,n=e.hasValue&&!e.trigger.searchQuery;return t([n&&r.createVNode("div",{class:"vue-treeselect__single-value"},[this.renderSingleValueLabel()]),r.createVNode(Et,null,null),r.createVNode(_t,{ref:"input"},null)])}},ye=(e,t)=>{const n=e.__vccOpts||e;for(const[s,i]of t)n[s]=i;return n},Tn={name:"vue-treeselect--x"},Ln={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 348.333 348.333"};function Mn(e,t,n,s,i,o){return r.openBlock(),r.createElementBlock("svg",Ln,t[0]||(t[0]=[r.createElementVNode("path",{d:"M336.559 68.611L231.016 174.165l105.543 105.549c15.699 15.705 15.699 41.145 0 56.85-7.844 7.844-18.128 11.769-28.407 11.769-10.296 0-20.581-3.919-28.419-11.769L174.167 231.003 68.609 336.563c-7.843 7.844-18.128 11.769-28.416 11.769-10.285 0-20.563-3.919-28.413-11.769-15.699-15.698-15.699-41.139 0-56.85l105.54-105.549L11.774 68.611c-15.699-15.699-15.699-41.145 0-56.844 15.696-15.687 41.127-15.687 56.829 0l105.563 105.554L279.721 11.767c15.705-15.687 41.139-15.687 56.832 0 15.705 15.699 15.705 41.145.006 56.844z"},null,-1)]))}const Ct=ye(Tn,[["render",Mn]]),Rn={name:"vue-treeselect--multi-value-item",inject:["instance"],props:{node:{type:Object,required:!0}},methods:{handleMouseDown:L(function(){const{instance:t,node:n}=this;t.select(n)})},render(){const{instance:e,node:t}=this,n={"vue-treeselect__multi-value-item":!0,"vue-treeselect__multi-value-item-disabled":t.isDisabled,"vue-treeselect__multi-value-item-new":t.isNew},s=e.$slots["value-label"],i=s?s({node:t}):t.label;return r.createVNode("div",{class:"vue-treeselect__multi-value-item-container"},[r.createVNode("div",{class:n,onMousedown:this.handleMouseDown},[r.createVNode("span",{class:"vue-treeselect__multi-value-label"},[i]),r.createVNode("span",{class:"vue-treeselect__icon vue-treeselect__value-remove"},[r.createVNode(Ct,null,null)])])])}},Vn={name:"vue-treeselect--multi-value",inject:["instance"],methods:{renderMultiValueItems(){const{instance:e}=this;return e.internalValue.slice(0,e.limit).map(e.getNode).map(t=>r.createVNode(Rn,{key:`multi-value-item-${t.id}`,node:t},null))},renderExceedLimitTip(){const{instance:e}=this,t=e.internalValue.length-e.limit;return t<=0?null:r.createVNode("div",{class:"vue-treeselect__limit-tip vue-treeselect-helper-zoom-effect-off",key:"exceed-limit-tip"},[r.createVNode("span",{class:"vue-treeselect__limit-tip-text"},[e.limitText(t)])])}},render(){const{renderValueContainer:e}=this.$parent;return e(r.createVNode(r.resolveComponent("TransitionGroup"),{class:"vue-treeselect__multi-value",tag:"div",name:"vue-treeselect__multi-value-item--transition",appear:!0},{default:()=>[this.renderMultiValueItems(),this.renderExceedLimitTip(),r.createVNode(Et,{key:"placeholder"},null),r.createVNode(_t,{ref:"input",key:"input"},null)]}))}},In={name:"vue-treeselect--arrow"},xn={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 292.362 292.362"};function Dn(e,t,n,s,i,o){return r.openBlock(),r.createElementBlock("svg",xn,t[0]||(t[0]=[r.createElementVNode("path",{d:"M286.935 69.377c-3.614-3.617-7.898-5.424-12.848-5.424H18.274c-4.952 0-9.233 1.807-12.85 5.424C1.807 72.998 0 77.279 0 82.228c0 4.948 1.807 9.229 5.424 12.847l127.907 127.907c3.621 3.617 7.902 5.428 12.85 5.428s9.233-1.811 12.847-5.428L286.935 95.074c3.613-3.617 5.427-7.898 5.427-12.847 0-4.948-1.814-9.229-5.427-12.85z"},null,-1)]))}const wt=ye(In,[["render",Dn]]),An={name:"vue-treeselect--control",inject:["instance"],computed:{shouldShowX(){const{instance:e}=this;return e.clearable&&!e.disabled&&e.hasValue&&(this.hasUndisabledValue||e.allowClearingDisabled)},shouldShowArrow(){const{instance:e}=this;return e.alwaysOpen?!e.menu.isOpen:!0},hasUndisabledValue(){const{instance:e}=this;return e.hasValue&&e.internalValue.some(t=>!e.getNode(t).isDisabled)}},methods:{renderX(){const{instance:e}=this,t=e.multiple?e.clearAllText:e.clearValueText;return this.shouldShowX?r.createVNode("div",{class:"vue-treeselect__x-container",title:t,onMousedown:this.handleMouseDownOnX},[r.createVNode(Ct,{class:"vue-treeselect__x"},null)]):null},renderArrow(){const{instance:e}=this,t={"vue-treeselect__control-arrow":!0,"vue-treeselect__control-arrow--rotated":e.menu.isOpen};return this.shouldShowArrow?r.createVNode("div",{class:"vue-treeselect__control-arrow-container",onMousedown:this.handleMouseDownOnArrow},[r.createVNode(wt,{class:t},null)]):null},handleMouseDownOnX:L(function(t){t.stopPropagation(),t.preventDefault();const{instance:n}=this,s=n.beforeClearAll(),i=o=>{o&&n.clear()};Je(s)?s.then(i):setTimeout(()=>i(s),0)}),handleMouseDownOnArrow:L(function(t){t.preventDefault(),t.stopPropagation();const{instance:n}=this;n.focusInput(),n.toggleMenu()}),renderValueContainer(e){return r.createVNode("div",{class:"vue-treeselect__value-container"},[e])}},render(){const{instance:e}=this,t=e.single?wn:Vn;return r.createVNode("div",{class:"vue-treeselect__control",onMousedown:e.handleMouseDown},[r.createVNode(t,{ref:"value-container"},null),this.renderX(),this.renderArrow()])}},_=r.defineComponent({name:"vue-treeselect--tip",functional:!0,props:{type:{type:String,required:!0},icon:{type:String,required:!0}},render(e){const{type:t,icon:n}=this;return r.createVNode("div",{class:`vue-treeselect__tip vue-treeselect__${t}-tip`},[r.createVNode("div",{class:"vue-treeselect__icon-container"},[r.createVNode("span",{class:`vue-treeselect__icon-${n}`},null)]),r.createVNode("span",{class:`vue-treeselect__tip-text vue-treeselect__${t}-tip-text`},[this.$slots.default()])])}});function Bn(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!r.isVNode(e)}let Ne,_e,Ee;const kn={name:"vue-treeselect--option",inject:["instance"],props:{node:{type:Object,required:!0}},computed:{shouldExpand(){const{instance:e,node:t}=this;return t.isBranch&&e.shouldExpand(t)},shouldShow(){const{instance:e,node:t}=this;return e.shouldShowOptionInMenu(t)}},methods:{renderOption(){const{instance:e,node:t}=this,n={"vue-treeselect__option":!0,"vue-treeselect__option--disabled":t.isDisabled,"vue-treeselect__option--selected":e.isSelected(t),"vue-treeselect__option--highlight":t.isHighlighted,"vue-treeselect__option--matched":e.localSearch.active&&t.isMatched,"vue-treeselect__option--hide":!this.shouldShow};return r.createVNode("div",{class:n,onMouseenter:this.handleMouseEnterOption,"data-id":t.id},[this.renderArrow(),this.renderLabelContainer([this.renderCheckboxContainer([this.renderCheckbox()]),this.renderLabel()])])},renderSubOptionsList(){return this.shouldExpand?r.createVNode("div",{class:"vue-treeselect__list"},[this.renderSubOptions(),this.renderNoChildrenTip(),this.renderLoadingChildrenTip(),this.renderLoadingChildrenErrorTip()]):null},renderArrow(){const{instance:e,node:t}=this;if(e.shouldFlattenOptions&&this.shouldShow)return null;if(t.isBranch){const n={"vue-treeselect__option-arrow":!0,"vue-treeselect__option-arrow--rotated":this.shouldExpand};return r.createVNode("div",{class:"vue-treeselect__option-arrow-container",onMousedown:this.handleMouseDownOnArrow},[r.createVNode(r.resolveComponent("Transition"),{name:"vue-treeselect__option-arrow--prepare",appear:!0},{default:()=>[r.createVNode(wt,{class:n},null)]})])}return e.hasBranchNodes?(Ne||(Ne=r.createVNode("div",{class:"vue-treeselect__option-arrow-placeholder"},[r.createTextVNode(" ")])),Ne):null},renderLabelContainer(e){return r.createVNode("div",{class:"vue-treeselect__label-container",onMousedown:this.handleMouseDownOnLabelContainer},[e])},renderCheckboxContainer(e){const{instance:t,node:n}=this;return t.single||t.disableBranchNodes&&n.isBranch?null:r.createVNode("div",{class:"vue-treeselect__checkbox-container"},[e])},renderCheckbox(){const{instance:e,node:t}=this,n=e.forest.checkedStateMap[t.id],s={"vue-treeselect__checkbox":!0,"vue-treeselect__checkbox--checked":n===dt,"vue-treeselect__checkbox--indeterminate":n===ut,"vue-treeselect__checkbox--unchecked":n===me,"vue-treeselect__checkbox--disabled":t.isDisabled};return _e||(_e=r.createVNode("span",{class:"vue-treeselect__check-mark"},null)),Ee||(Ee=r.createVNode("span",{class:"vue-treeselect__minus-mark"},null)),r.createVNode("span",{class:s},[_e,Ee])},renderLabel(){const{instance:e,node:t}=this,n=t.isBranch&&(e.localSearch.active?e.showCountOnSearchComputed:e.showCount),s=n?e.localSearch.active?e.localSearch.countMap[t.id][e.showCountOf]:t.count[e.showCountOf]:NaN,i="vue-treeselect__label",o="vue-treeselect__count",a=e.$slots["option-label"];return a?a({node:t,shouldShowCount:n,count:s,labelClassName:i,countClassName:o}):r.createVNode("label",{class:i},[t.label,n&&r.createVNode("span",{class:o},[r.createTextVNode("("),s,r.createTextVNode(")")])])},renderSubOptions(){const{node:e}=this;return e.childrenStates.isLoaded?e.children.map(t=>r.createVNode(r.resolveComponent("vue-treeselect--option"),{node:t,key:t.id},null)):null},renderNoChildrenTip(){const{instance:e,node:t}=this;return!t.childrenStates.isLoaded||t.children.length?null:r.createVNode(_,{type:"no-children",icon:"warning"},{default:()=>[e.noChildrenText]})},renderLoadingChildrenTip(){const{instance:e,node:t}=this;return t.childrenStates.isLoading?r.createVNode(_,{type:"loading",icon:"loader"},{default:()=>[e.loadingText]}):null},renderLoadingChildrenErrorTip(){const{instance:e,node:t}=this;return t.childrenStates.loadingError?r.createVNode(_,{type:"error",icon:"error"},{default:()=>[t.childrenStates.loadingError,r.createVNode("a",{class:"vue-treeselect__retry",title:e.retryTitle,onMousedown:this.handleMouseDownOnRetry},[e.retryText])]}):null},handleMouseEnterOption(e){const{instance:t,node:n}=this;e.target===e.currentTarget&&t.setCurrentHighlightedOption(n,!1)},handleMouseDownOnArrow:L(function(){const{instance:t,node:n}=this;t.toggleExpanded(n)}),handleMouseDownOnLabelContainer:L(function(){const{instance:t,node:n}=this;n.isBranch&&t.disableBranchNodes?t.toggleExpanded(n):t.select(n)}),handleMouseDownOnRetry:L(function(){const{instance:t,node:n}=this;t.loadChildrenOptions(n)})},render(){let e;const{node:t}=this,s={"vue-treeselect__list-item":!0,[`vue-treeselect__indent-level-${this.instance.shouldFlattenOptions?0:t.level}`]:!0};return r.createVNode("div",{class:s},[this.renderOption(),t.isBranch?r.createVNode(r.resolveComponent("Transition"),{name:"vue-treeselect__list--transition"},Bn(e=this.renderSubOptionsList())?e:{default:()=>[e]}):""])}};function zn(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!r.isVNode(e)}const $n={top:"top",bottom:"bottom",above:"top",below:"bottom"},Tt={name:"vue-treeselect--menu",inject:["instance"],computed:{menuStyle(){const{instance:e}=this;return{maxHeight:e.maxHeight+"px"}},menuContainerStyle(){const{instance:e}=this;return{zIndex:e.appendToBody?null:e.zIndex}}},watch:{"instance.menu.isOpen"(e){e?this.$nextTick(this.onMenuOpen):this.onMenuClose()}},created(){this.menuSizeWatcher=null,this.menuResizeAndScrollEventListeners=null},mounted(){const{instance:e}=this;e.menu.isOpen&&this.$nextTick(this.onMenuOpen)},unmounted(){this.onMenuClose()},methods:{renderMenu(){const{instance:e}=this;return e.menu.isOpen?r.createVNode("div",{key:e.key,ref:"menu",class:"vue-treeselect__menu",onMousedown:e.handleMouseDown,style:this.menuStyle},[this.renderBeforeList(),e.async?this.renderAsyncSearchMenuInner():e.localSearch.active?this.renderLocalSearchMenuInner():this.renderNormalMenuInner(),this.renderAfterList()]):null},renderBeforeList(){const{instance:e}=this,t=e.$slots["before-list"];return t?t():null},renderAfterList(){const{instance:e}=this,t=e.$slots["after-list"];return t?t():null},renderNormalMenuInner(){const{instance:e}=this;return e.rootOptionsStates.isLoading?this.renderLoadingOptionsTip():e.rootOptionsStates.loadingError?this.renderLoadingRootOptionsErrorTip():e.rootOptionsStates.isLoaded&&e.forest.normalizedOptions.length===0?this.renderNoAvailableOptionsTip():this.renderOptionList()},renderLocalSearchMenuInner(){const{instance:e}=this;return e.rootOptionsStates.isLoading?this.renderLoadingOptionsTip():e.rootOptionsStates.loadingError?this.renderLoadingRootOptionsErrorTip():e.rootOptionsStates.isLoaded&&e.forest.normalizedOptions.length===0?this.renderNoAvailableOptionsTip():e.localSearch.noResults?this.renderNoResultsTip():this.renderOptionList()},renderAsyncSearchMenuInner(){const{instance:e}=this,t=e.getRemoteSearchEntry(),n=e.trigger.searchQuery===""&&!e.defaultOptions,s=n?!1:t.isLoaded&&t.options.length===0;return n?this.renderSearchPromptTip():t.isLoading?this.renderLoadingOptionsTip():t.loadingError?this.renderAsyncSearchLoadingErrorTip():s?this.renderNoResultsTip():this.renderOptionList()},renderOptionList(){const{instance:e}=this;return r.createVNode("div",{class:"vue-treeselect__list"},[e.forest.normalizedOptions.map(t=>r.createVNode(kn,{node:t,key:t.id},null))])},renderSearchPromptTip(){const{instance:e}=this;return r.createVNode(_,{type:"search-prompt",icon:"warning"},{default:()=>[e.searchPromptText]})},renderLoadingOptionsTip(){const{instance:e}=this;return r.createVNode(_,{type:"loading",icon:"loader"},{default:()=>[e.loadingText]})},renderLoadingRootOptionsErrorTip(){const{instance:e}=this;return r.createVNode(_,{type:"error",icon:"error"},{default:()=>[e.rootOptionsStates.loadingError,r.createVNode("a",{class:"vue-treeselect__retry",onClick:e.loadRootOptions,title:e.retryTitle},[e.retryText])]})},renderAsyncSearchLoadingErrorTip(){const{instance:e}=this,t=e.getRemoteSearchEntry();return r.createVNode(_,{type:"error",icon:"error"},{default:()=>[t.loadingError,r.createVNode("a",{class:"vue-treeselect__retry",onClick:e.handleRemoteSearch,title:e.retryTitle},[e.retryText])]})},renderNoAvailableOptionsTip(){const{instance:e}=this;return r.createVNode(_,{type:"no-options",icon:"warning"},{default:()=>[e.noOptionsText]})},renderNoResultsTip(){const{instance:e}=this;return r.createVNode(_,{type:"no-results",icon:"warning"},{default:()=>[e.noResultsText]})},onMenuOpen(){this.adjustMenuOpenDirection(),this.setupMenuSizeWatcher(),this.setupMenuResizeAndScrollEventListeners()},onMenuClose(){this.removeMenuSizeWatcher(),this.removeMenuResizeAndScrollEventListeners()},adjustMenuOpenDirection(){const{instance:e}=this;if(!e.menu.isOpen)return;const t=e.getMenu(),n=e.getControl(),s=t.getBoundingClientRect(),i=n.getBoundingClientRect(),o=s.height,a=window.innerHeight,u=i.top,d=window.innerHeight-i.bottom,l=i.top>=0&&i.top<=a||i.top<0&&i.bottom>0,f=d>o+Ot,h=u>o+Ot;l?e.openDirection!=="auto"?e.menu.placement=$n[e.openDirection]:f||!h?e.menu.placement="bottom":e.menu.placement="top":e.closeMenu()},setupMenuSizeWatcher(){const{instance:e}=this,t=e.getMenu();this.menuSizeWatcher||(this.menuSizeWatcher={remove:Ge(t,this.adjustMenuOpenDirection)})},setupMenuResizeAndScrollEventListeners(){const{instance:e}=this,t=e.getControl();this.menuResizeAndScrollEventListeners||(this.menuResizeAndScrollEventListeners={remove:Ye(t,this.adjustMenuOpenDirection)})},removeMenuSizeWatcher(){this.menuSizeWatcher&&(this.menuSizeWatcher.remove(),this.menuSizeWatcher=null)},removeMenuResizeAndScrollEventListeners(){this.menuResizeAndScrollEventListeners&&(this.menuResizeAndScrollEventListeners.remove(),this.menuResizeAndScrollEventListeners=null)}},render(){let e;return r.createVNode("div",{ref:"menu-container",class:"vue-treeselect__menu-container",style:this.menuContainerStyle},[r.createVNode(r.resolveComponent("Transition"),{name:"vue-treeselect__menu--transition"},zn(e=this.renderMenu())?e:{default:()=>[e]})])}},Fn={name:"vue-treeselect--portal-target",inject:["instance"],watch:{"instance.menu.isOpen"(e){e?this.setupHandlers():this.removeHandlers()},"instance.menu.placement"(){this.updateMenuContainerOffset()}},created(){this.controlResizeAndScrollEventListeners=null,this.controlSizeWatcher=null},mounted(){const{instance:e}=this;e.menu.isOpen&&this.setupHandlers()},methods:{setupHandlers(){this.updateWidth(),this.updateMenuContainerOffset(),this.setupControlResizeAndScrollEventListeners(),this.setupControlSizeWatcher()},removeHandlers(){this.removeControlResizeAndScrollEventListeners(),this.removeControlSizeWatcher()},setupControlResizeAndScrollEventListeners(){const{instance:e}=this,t=e.getControl();this.controlResizeAndScrollEventListeners||(this.controlResizeAndScrollEventListeners={remove:Ye(t,this.updateMenuContainerOffset)})},setupControlSizeWatcher(){const{instance:e}=this,t=e.getControl();this.controlSizeWatcher||(this.controlSizeWatcher={remove:Ge(t,()=>{this.updateWidth(),this.updateMenuContainerOffset()})})},removeControlResizeAndScrollEventListeners(){this.controlResizeAndScrollEventListeners&&(this.controlResizeAndScrollEventListeners.remove(),this.controlResizeAndScrollEventListeners=null)},removeControlSizeWatcher(){this.controlSizeWatcher&&(this.controlSizeWatcher.remove(),this.controlSizeWatcher=null)},updateWidth(){const{instance:e}=this,t=this.$el,s=e.getControl().getBoundingClientRect();t.style.width=s.width+"px"},updateMenuContainerOffset(){const{instance:e}=this,t=e.getControl(),n=this.$el,s=t.getBoundingClientRect(),i=n.getBoundingClientRect(),o=e.menu.placement==="bottom"?s.height:0,a=Math.round(s.left-i.left)+"px",u=Math.round(s.top-i.top+o)+"px",d=this.$refs.menu.$refs["menu-container"].style,f=ct(["transform","webkitTransform","MozTransform","msTransform"],h=>h in document.body.style);d[f]=`translate(${a}, ${u})`}},render(){const{instance:e}=this,t=["vue-treeselect__portal-target",e.wrapperClass],n={zIndex:e.zIndex};return r.createVNode("div",{class:t,style:n,"data-instance-id":e.getInstanceId()},[r.createVNode(Tt,{ref:"menu"},null)])},unmounted(){this.removeHandlers()}};let Ce;const Hn={name:"vue-treeselect--menu-portal",inject:["instance"],created(){this.portalTarget=null},mounted(){this.setup()},unmounted(){this.teardown()},methods:{setup(){const{instance:e}=this,t=document.createElement("div");document.body.appendChild(t),this.portalTarget=r.createApp({parent:this,...Fn}).provide("instance",e).mount(t)},teardown(){var e,t;(t=(e=this.portalTarget.$el)==null?void 0:e.parentNode)==null||t.removeChild(this.portalTarget.$el),this.portalTarget.$el.innerHTML="",this.portalTarget=null}},render(){return Ce||(Ce=r.createVNode("div",{class:"vue-treeselect__menu-placeholder"},null)),Ce}},Wn=r.defineComponent({name:"vue-treeselect",mixins:[Nt],components:{HiddenFields:En,Control:An,Menu:Tt,MenuPortal:Hn},computed:{wrapperClass(){return{"vue-treeselect":!0,"vue-treeselect--single":this.single,"vue-treeselect--multi":this.multiple,"vue-treeselect--searchable":this.searchable,"vue-treeselect--disabled":this.disabled,"vue-treeselect--focused":this.trigger.isFocused,"vue-treeselect--has-value":this.hasValue,"vue-treeselect--open":this.menu.isOpen,"vue-treeselect--open-above":this.menu.placement==="top","vue-treeselect--open-below":this.menu.placement==="bottom","vue-treeselect--branch-nodes-disabled":this.disableBranchNodes,"vue-treeselect--append-to-body":this.appendToBody}}}});function jn(e,t,n,s,i,o){const a=r.resolveComponent("HiddenFields"),u=r.resolveComponent("Control"),d=r.resolveComponent("MenuPortal"),l=r.resolveComponent("Menu");return r.openBlock(),r.createElementBlock("div",{ref:"wrapper",class:r.normalizeClass(e.wrapperClass)},[r.createVNode(a),r.createVNode(u,{ref:"control"},null,512),e.appendToBody?(r.openBlock(),r.createBlock(d,{key:0,ref:"portal"},null,512)):(r.openBlock(),r.createBlock(l,{key:1,ref:"menu"},null,512))],2)}const Lt=ye(Wn,[["render",jn]]);v.ASYNC_SEARCH=pt,v.LOAD_CHILDREN_OPTIONS=ft,v.LOAD_ROOT_OPTIONS=ht,v.Treeselect=Lt,v.default=Lt,v.treeselectMixin=Nt,Object.defineProperties(v,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
